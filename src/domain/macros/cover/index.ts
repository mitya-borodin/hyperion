/* eslint-disable unicorn/no-empty-file */
import debug from 'debug';
import defaultsDeep from 'lodash.defaultsdeep';

import { stringify } from '../../../helpers/json-stringify';
import { ControlType } from '../../control-type';
import { Macros, MacrosParameters } from '../macros';
import { MacrosType } from '../showcase';

const logger = debug('hyperion:macros:boiler');

/**
 * ! SETTINGS
 */

/**
 * –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è (—Ä–µ–ª–µ, –∫–Ω–æ–ø–∫–∞).
 */
export enum Switch {
  ON = 'ON',
  OFF = 'OFF',
}

/**
 * –£—Ä–æ–≤–Ω–∏ –æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç–∏ –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–µ–¥–µ–ª–∏–ª –º–∞–∫—Ä–æ—Å –ø–æ –≤—Å–µ–º –∏–º–µ—é—â–∏–º—Å—è –¥–∞—Ç—á–∏–∫–∞–º
 * –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ø—Ä–∞–≤–∏–ª–æ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.
 */
export enum LightingLevel {
  MAX = 3,
  HIGHT = 2,
  MIDDLE = 1,
  LOW = 0,
  UNSPECIFIED = -1,
}

/**
 * ! Cover macros scenarios
 *
 * –í –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–æ–ª—å –∫—Ä—ã—à–∫–∏ –±—É–¥–µ—Ç –∏–≥—Ä–∞—Ç—å —à—Ç–æ—Ä–∞, –Ω–æ –≤–º–µ—Å—Ç–æ —à—Ç–æ—Ä—ã –º–æ–≥—É—Ç –±—ã—Ç—å –ª—é–±—ã–µ –¥—Ä—É–≥–∏–µ
 *  —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Ç–∏–ø–∞ Cover https://www.zigbee2mqtt.io/guide/usage/exposes.html#specific
 *
 * –®—Ç–æ—Ä—ã —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –ø–æ–º–æ—â–∏:
 *  –ö–Ω–æ–ø–æ–∫
 *  –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞
 *  –ì–µ—Ä–∫–æ–Ω–æ–≤
 *  –û—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç–∏
 *  –î–≤–∏–∂–µ–Ω–∏—è
 *  –®—É–º–∞
 *  –í—Ä–µ–º–µ–Ω–∏
 *  –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ
 *
 * 1. –û—Ç–∫—Ä—ã—Ç—å/–ó–∞–∫—Ä—ã—Ç—å/–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –ª–∏–±–æ —á–µ—Ä–µ–∑ —Ä–µ–∞–ª—å–Ω—É—é –ª–∏–±–æ —á–µ—Ä–µ–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é.
 *  –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å–ø–æ—Å–æ–± –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —à—Ç–æ—Ä—ã, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –Ω—É–∂–Ω–æ –Ω–∞–∂–∏–º–∞—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É.
 *
 *  –°–ø–æ—Å–æ–± —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–º –Ω–∞–¥ –≤—Å–µ–º–∏ –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏, –∏ –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è,
 *    –Ω–∞ –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è.
 *  –¢–æ –µ—Å—Ç—å –≤ —Å–ª—É—á–∞–µ –æ—Ç–∫—Ä—ã–≤–∞–Ω–∏—è/–∑–∞–∫—Ä—ã–≤–∞–Ω–∏—è –∫–Ω–æ–ø–∫–æ–π, —à—Ç–æ—Ä–∞ –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ –∏–∑–º–µ–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ
 *    –¥–µ–π—Å—Ç–≤–∏—è –±—É–¥—É—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –≤—Ä–µ–º—è —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.
 *
 * –ß—Ç–æ–±—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –æ—Ç–∫—Ä—ã—Ç—å/–∑–∞–∫—Ä—ã—Ç—å –≤—Å–µ, –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä –º–∞–∫—Ä–æ—Å–∞,
 *  –∫—É–¥–∞ –¥–æ–±–∞–≤–∏—Ç—å –æ–¥–Ω—É –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –∫–Ω–æ–ø—É –∏ –≤—Å–µ —à—Ç–æ—Ä—ã.
 * –ù–∞–∂–∏–º–∞—è –Ω–∞ –Ω–µ—ë —á–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –≤—Å–µ —à—Ç–æ—Ä—ã –±—É–¥—É—Ç –ø–æ–ª—É—á–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã.
 *
 * 2. –û—Ç–∫—Ä—ã—Ç—å –ø–æ –≥–µ—Ä–∫–æ–Ω—É
 *  –ü–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—á–∞—Ç—å –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —à—Ç–æ—Ä—ã –ø—Ä–∏ –æ—Ç—Ä—ã–≤–∞–Ω–∏–∏ –¥–≤–µ—Ä–∏, –æ–∫–Ω–∞, –∏ –¥—Ä—É–≥–∏—Ö –æ—Ç–∫—Ä—ã–≤–∞—é—â–∏—Ö—Å—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π.
 *
 *  –ú–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å –¥–∞—Ç—á–∏–∫–æ–º –æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç–∏, –∏ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏
 *    —É–∫–∞–∑–∞–Ω–Ω–æ–π –æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–∞—á–∏–Ω–∞—Ç—å –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —à—Ç–æ—Ä—É –≤ –º–æ–º–µ–Ω—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è –≥–µ—Ä–∫–æ–Ω–∞.
 *
 *  –ù–∞–ø—Ä–∏–º–µ—Ä –≤ —Å–ª—É—á–∞–µ –æ—Ç–∫—Ä—ã–≤–∞–Ω–∏—è –¥–≤–µ—Ä–∏ –≤ –∫–æ—Ç–µ–ª—å–Ω—É—é, –≤ –∫–æ—Ç–æ—Ä–æ–π –≤–µ—Å–∏—Ç —à—Ç–æ—Ä–∞, –æ—Ç–∫—Ä—ã–≤–∞–µ–º –¥–≤–µ—Ä—å, –∏ –∂–¥–µ–º –ø–æ–∫–∞ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —à—Ç–æ—Ä–∞.
 *  –ù–∞–ø—Ä–∏–º–µ—Ä —É—Ç—Ä–æ–º (–æ—Å–≤–µ—â–µ–Ω–∏–µ –≤—ã—à–µ —É—Å—Ç–∞–≤–∫–∏) –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Å–ø–∞–ª—å–Ω–∏ –Ω–∞—á–∏–Ω–∞—é—Ç –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è –ø—Ä–∏—Ö–æ–∂–∞—è –∏ –≥–æ—Å—Ç–∏–Ω–∞—è.
 *
 * 3. –û—Ç–∫—Ä—ã—Ç—å/–ó–∞–∫—Ä—ã—Ç—å –ø–æ –æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç–∏
 *  –ü–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å –ø–æ—Ä–æ–≥–∏ –æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç–∏ –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä—ã—Ö –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —à—Ç–æ—Ä—ã.
 *
 *  –ü–æ—Ä–æ–≥ –∑–∞–¥–∞–µ—Ç—Å—è –∫–æ—Ä—Ç–µ–∂–µ–º [CLOSE, OPEN], –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ä–æ–≥–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π [[25, 150], [300, 3000]].
 *
 *  –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ CLOSE < OPEN, —Ç–æ –ø—Ä–∏ –æ—Å–≤–µ—â–µ–Ω–∏–∏ –º–µ–Ω—å—à–µ (<) CLOSE —à—Ç–æ—Ä–∞ –±—É–¥–µ—Ç –∑–∞–∫—Ä—ã–≤–∞—Ç—å—Å—è,
 *   –∞ –ø—Ä–∏ –∑–Ω–∞—á–µ–Ω–∏–∏ –±–æ–ª—å—à–µ (>) OPEN –±—É–¥–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è.
 *
 *  –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ CLOSE > OPEN, —Ç–æ –ø—Ä–∏ –æ—Å–≤–µ—â–µ–Ω–∏–∏ –±–æ–ª—å—à–µ (>) CLOSE —à—Ç–æ—Ä–∞ –±—É–¥–µ—Ç –∑–∞–∫—Ä—ã–≤–∞—Ç—å—Å—è,
 *   –∞ –ø—Ä–∏ –∑–Ω–∞—á–µ–Ω–∏–∏ –º–µ–Ω—å—à–µ (<) OPEN –±—É–¥–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è.
 *
 *  –ù—É–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å, —Ç–æ, —á—Ç–æ –∫–æ–≥–¥–∞ —à—Ç–æ—Ä–∞ –∑–∞–∫—Ä—ã—Ç–∞, —Å–∏–ª–∞ —Å–æ–ª–Ω–µ—á–Ω–æ–≥–æ –æ—Å–≤–µ—â–µ–Ω–∏—è —Å–∏–ª—å–Ω–æ –º–µ–Ω—å—à–µ, –∏ –Ω—É–∂–Ω–æ –ø—Ä–∏ –ø—É—Å–∫–æ–Ω–∞–ª–∞–¥–∫–µ
 *    –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞–∫–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–æ–π —à—Ç–æ—Ä–µ –±—É–¥–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏–º –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è.
 *  –ü—É—Å–∫–∞ –Ω–∞–ª–∞–¥–∫—É —Å–ª–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ –¥–µ–Ω—å –æ–∫–æ–Ω—á–∞–Ω–∏—è –º–æ–Ω—Ç–∞–∂–∞, –ø–æ —ç—Ç–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –±—É–¥–µ—Ç –≤—ã–¥–∞–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
 *    –æ —Ç–æ–º –∫–∞–∫ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç–∏.
 *
 *  –ù–∞–ø—Ä–∏–º–µ—Ä:
 *    - –ü–æ—Ç–µ–º–Ω–µ–ª–æ –∏ –≤ —Å–≤—è–∑–∏ —Å —ç—Ç–∏–º —Å—Ç–æ–∏—Ç –∑–∞–∫—Ä—ã—Ç—å —à—Ç–æ—Ä—ã, —á—Ç–æ–±—ã —Å —É–ª–∏—Ü—ã –Ω–µ –±—ã–ª–æ –≤–∏–¥–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—â–µ–≥–æ –≤–Ω—É—Ç—Ä–∏
 *       [ –ø—Ä–∏ 25 –∑–∞–∫—Ä—ã—Ç—å, –ø—Ä–∏ 150 –æ—Ç–∫—Ä—ã—Ç—å], –∞ –∫–∞–∫ —Ç–æ–ª—å–∫–æ —Å–æ–ª–Ω—Ü–µ –≤–∑–æ–π–¥–µ—Ç –∏ –æ—Å–≤–µ—â–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–æ–π —à—Ç–æ—Ä–µ
 *       —Å—Ç–∞–Ω–µ—Ç –≤—ã—à–µ —É—Å—Ç–∞–≤–∫–∏, –º–æ–∂–Ω–æ –ø—ã—Ç–∞—Ç—å—Å—è –æ—Ç–∫—Ä—ã—Ç—å —à—Ç–æ—Ä—É.
 *    - –°–æ–ª–Ω—Ü–µ –≤–∑–æ—à–ª–æ –∏–ª–∏ —Ç—É—á–∏ —Ä–∞—Å—Å–µ—è–ª–∏—Å—å –ø–æ—Å–ª–µ —Å—É–º–µ—Ä–µ–∫, —Å—Ç–æ–∏—Ç –æ—Ç–∫—Ä—ã—Ç—å —à—Ç–æ—Ä—ã –¥–ª—è –∏–Ω—Å–æ–ª—è—Ü–∏–∏ –ø–æ–º–µ—â–µ–Ω–∏—è
 *       [ –∑–∞–∫—Ä—ã—Ç—å –ø—Ä–∏ 100 –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–π —à—Ç–æ—Ä–µ, –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏ 150 –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–æ–π —à—Ç–æ—Ä–µ].
 *    - –°–æ–ª–Ω—Ü–µ —Å–ª–∏—à–∫–æ–º —è—Ä–∫–æ–µ –∏/–∏–ª–∏ —Å–≤–µ—Ç–∏—Ç –Ω–∞ –º–æ–Ω–∏—Ç–æ—Ä, —Å—Ç–æ–∏—Ç –∑–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ, –∏ –∫–∞–∫ —Ç–æ–ª—å–∫–æ –æ—Å–≤–µ—â–µ–Ω–∏–µ —É–ø–∞–¥–µ—Ç
 *       –¥–æ –Ω—É–∂–Ω–æ–≥–æ –ø–æ—Ä–æ–≥–∞ –æ—Ç–∫—Ä—ã—Ç—å —à—Ç–æ—Ä—É [–∑–∞–∫—Ä—ã—Ç—å –ø—Ä–∏ 3000 –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–π —à—Ç–æ—Ä–µ, –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏ 300 –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–æ–π —à—Ç–æ—Ä–µ ].
 *
 * 4. –û—Ç–∫—Ä—ã–≤–∞–Ω–∏–µ/–ó–∞–∫—Ä—ã–≤–∞–Ω–∏–µ –ø–æ –¥–∞—Ç—á–∏–∫—É –¥–≤–∏–∂–µ–Ω–∏—è –∏/–∏–ª–∏ —à—É–º—É.
 *  –î–æ–ø–æ–ª–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —à—Ç–æ—Ä—ã –ø–æ –æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç–∏,
 *   –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —à—Ç–æ—Ä—ã, –ø–æ–∫–∞ –Ω–µ –ø–æ—è–≤–∏—Ç—Å—è –¥–≤–∏–∂–µ–Ω–∏–µ –∏/–∏–ª–∏ —à—É–º, –¥–∞–∂–µ –∫–æ–≥–¥–∞ –æ—Å–≤–µ—â–µ–Ω–∏–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –æ—Ç–∫—Ä—ã–≤–∞–Ω–∏—è.
 *
 *  –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –æ—Å–≤–µ—â–µ–Ω–∏–∏ –æ—Ç–∫—Ä—ã—Ç—å —à—Ç–æ—Ä—ã –≤ –Ω—É–∂–Ω—ã—Ö –º–µ—Å—Ç–∞ –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –¥–≤–∏–∂–µ–Ω–∏—è
 *   –ª–∏–±–æ —à—É–º–∞ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –¥–∞—Ç—á–∏–∫–∞—Ö, —Å–≤—ã—à–µ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.
 *
 * 5. –û—Ç–∫—Ä—ã—Ç—å/–ó–∞–∫—Ä—ã—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏
 *  –í—Ç–æ—Ä–æ–π –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ—Å–ª–µ —Ä—É—á–Ω–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É.
 *
 *  –ü–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å –≤ –∫–∞–∫–æ–π —á–∞—Å –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —à—Ç–æ—Ä—ã.
 *  –ú–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –ø–æ –¥–µ–π—Å—Ç–≤–∏—é –Ω–∞ –∫–∞–∂–¥—ã–π —á–∞—Å.
 *
 *  { type: "OPEN", blockHours: 2, hours: [1,4,6,8] } - –®—Ç–æ—Ä–∞ –±—É–¥–µ—Ç –ø—ã—Ç–∞—Ç—å—Å—è –æ—Ç–∫—Ä—ã—Ç—å—Å—è –≤ —á–∞—Å –Ω–æ—á–∏, –≤ 4, 6, 8
 *    —É—Ç—Ä–∞ –ø—Ä–∏—á–µ–º –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –ø–æ–ø—ã—Ç–∫–∏ –±—É–¥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è.
 *
 *  { type: "CLOSE", blockHours: 8, hours: [18,20,0] } - –®—Ç–æ—Ä–∞ –±—É–¥–µ—Ç –ø—ã—Ç–∞—Ç—å—Å—è –∑–∞–∫—Ä—ã—Ç—å—Å—è –≤ 18, 20, 0, —á–∞—Å–æ–≤
 *    –ø—Ä–∏—á–µ–º –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –ø–æ–ø—ã—Ç–∫–∏ –±—É–¥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è.
 *
 *  –í —Å–ª—É—á–∞–µ –µ—Å–ª–∏ —à—Ç–æ—Ä–∞ –∏ —Ç–∞–∫ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ OPEN –∏–ª–∏ CLOSE –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç.
 *  –ü—Ä–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –±—É–¥–µ—Ç –æ—Ç–¥–∞–Ω –æ–ø–µ—Ä–∞—Ü–∏–∏ CLOSE.
 *
 * 6. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏
 *  –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —à—Ç–æ—Ä—ã –≤ –∑–∞–¥–∞–Ω–Ω–æ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ.
 *
 *  –í–æ–∑–º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∫–∞–∫–æ–µ –∏–º–µ–Ω–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å, [[OPEN, 23, 9], [CLOSE, 11,16], [ANY, 21-22]].
 *
 *  –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π.
 *
 *  –í —Å–ª—É—á–∞–µ –∫–æ–≥–¥–∞ –º—ã –Ω–µ —Ö–æ—Ç–∏–º –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —à—Ç–æ—Ä—É —Å –Ω–æ—á–∏ –¥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–Ω—è –Ω–∞–ø—Ä–∏–º–µ—Ä –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –¥–æ
 *    10 –¥–Ω—è, –º—ã –∑–∞–¥–∞–¥–∏–º [[OPEN, 0, 10]].
 *  –í —Å–ª—É—á–∞–µ –∫–æ–≥–¥–∞ –º—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–µ —Ö–æ—Ç–∏–º –∑–∞–∫—Ä—ã–≤–∞—Ç—å —à—Ç–æ—Ä—ã –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –¥–Ω—è, –º—ã –∑–∞–¥–∞–¥–∏–º [[CLOSE, 11,16]].
 *  –í —Å–ª—É—á–∞–µ –∫–æ–≥–¥–∞ –º—ã —Ö–æ—Ç–∏–º –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –≤—Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è, —Å–∫–∞–∂–µ–º –ø–µ—Ä–µ–¥ —Å–Ω–æ–º [[ANY, 20,23]].
 *
 *  –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –º—ã –ø–æ–ª—É—á–∏–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É [[OPEN, 0, 10], [CLOSE, 10,16], [ANY, 20,23]].
 *
 * –ù—É–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∑–∞ —á–∞—Å—Ç—É—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à—Ç–æ—Ä–∞–º–∏
 *  –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ –æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç–∏ + –¥–≤–∏–∂–µ–Ω–∏–µ –∏ —à—É–º.
 *
 * 7. –û—Ç–∫—Ä—ã—Ç—å/–ó–∞–∫—Ä—ã—Ç—å –ø–æ –æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç–∏ –¥–≤–∏–∂–µ–Ω–∏—é, —à—É–º—É –∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ
 *  –í —Å–æ–ª–Ω–µ—á–Ω—ã–µ –¥–Ω–∏ –≤ –∫–æ–º–Ω–∞—Ç—É –º–æ–∂–µ—Ç –ø—Ä–æ–Ω–∏–∫–∞—Ç—å —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ç–µ–ø–ª–∞ –æ—Ç —Å–æ–ª–Ω—Ü–∞ –∏ —ç—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
 *   –¥–∞—Å—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–∫—Ä—ã—Ç—å —à—Ç–æ—Ä—É, –µ—Å–ª–∏ –≤ –ø–æ–º–µ—â–µ–Ω–∏–∏ –≤—ã—Ä–æ—Å–ª–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç–∏.
 *
 *  –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–∫—Ä—ã—Ç—å —à—Ç–æ—Ä—É –µ—Å–ª–∏ –æ—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç—å –≤—ã—à–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –ø–æ—Ä–æ–≥–∞, —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å
 *    –ø–æ–ª–Ω–∞—è —Ç–∏—à–∏–Ω–∞ –Ω–∏ –¥–≤–∏–∂–µ–Ω–∏—è –Ω–∏ —à—É–º–∞ –¥–æ–ª—å—à–µ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–µ–∂—É—Ç–∫–∞ —Å–∫–∞–∂–µ–º 1 —á–∞—Å, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ã—à–µ –∑–∞–¥–∞–Ω–Ω–æ–π —É—Å—Ç–∞–≤–∫–∏.
 *
 *  –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–∫—Ä—ã—Ç—å —à—Ç–æ—Ä—É –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é, –∞ –ø—Ä–∏–∫—Ä—ã—Ç—å –Ω–∞ –Ω—É–∂–Ω—É—é –≤–µ–ª–∏—á–∏–Ω—É.
 *
 *  –û—Ç–∫—Ä—ã–≤–∞–Ω–∏–µ —à—Ç–æ—Ä—ã –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º "4. –û—Ç–∫—Ä—ã–≤–∞–Ω–∏–µ/–ó–∞–∫—Ä—ã–≤–∞–Ω–∏–µ –ø–æ –¥–∞—Ç—á–∏–∫—É –¥–≤–∏–∂–µ–Ω–∏—è –∏/–∏–ª–∏ —à—É–º—É.".
 */
export type CoverMacrosSettings = {
  readonly switchers: Array<{
    readonly deviceId: string;
    readonly controlId: string;
    readonly controlType: ControlType.SWITCH;
  }>;
  readonly illuminations: Array<{
    readonly deviceId: string;
    readonly controlId: string;
    readonly controlType: ControlType.ILLUMINATION;
  }>;
  readonly motion: Array<{
    readonly deviceId: string;
    readonly controlId: string;
    readonly controlType: ControlType.VALUE;
  }>;
  readonly noise: Array<{
    readonly deviceId: string;
    readonly controlId: string;
    readonly controlType: ControlType.SOUND_LEVEL;
  }>;
  readonly temperature: {
    readonly deviceId: string;
    readonly controlId: string;
    readonly controlType: ControlType.TEMPERATURE;
  };
  readonly position: {
    readonly deviceId: string;
    readonly controlId: string;
    readonly controlType: ControlType.VALUE;
  };
  readonly state: {
    readonly deviceId: string;
    readonly controlId: string;
    readonly controlType: ControlType.ENUM;
  };
};

/**
 * ! STATE
 */
export type CoverMacrosPublicState = {
  /**
   * –ü–æ–ª–æ–∂–µ–Ω–∏–µ –∫—Ä—ã—à–∫–∏, –æ—Ç 0 –¥–æ 100.
   */
  position: number;

  /**
   * –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
   *
   * OPEN - –∫—Ä—ã—à–∫–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
   * CLOSE - –∫—Ä—ã—à–∫–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è
   * STOP - –∫—Ä—ã—à–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
   *
   * enum –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã–º –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤.
   */
  state: string;
};

type CoverMacrosPrivateState = {
  switch: Switch;
  illumination: number;
  motion: number;
  noise: number;
  temperature: number;
};

type CoverMacrosState = CoverMacrosPublicState & CoverMacrosPrivateState;

/**
 * ! OUTPUT
 */
/**
 * –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –º–∞–∫—Ä–æ—Å —Ä–µ—à–∞–µ—Ç, –∫–∞–∫–∏–º —Å–ø–æ—Å–æ–±–æ–º –ø–æ –≤–ª–∏—è—Ç—å –Ω–∞ –∫—Ä—ã—à–∫—É
 * —É–∫–∞–∑–∞—Ç—å –ø–æ–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ position, –ª–∏–±–æ –∑–∞–¥–∞—Ç—å state —á—Ç–æ–±—ã –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∫—Ä—ã—à–∫–∏
 * —Å–¥–µ–ª–∞–ª –≤—Å—é —Ä–∞–±–æ—Ç—É, –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫—Ä—ã–ª, –∑–∞–∫—Ä—ã–ª, –æ—Å—Ç–∞–Ω–æ–≤–∏–ª –∫—Ä—ã—à–∫—É.
 */
type CoverMacrosNextOutput = {
  position?: {
    readonly deviceId: string;
    readonly controlId: string;
    readonly controlType: ControlType.VALUE;
    readonly value: number;
  };
  state?: {
    readonly deviceId: string;
    readonly controlId: string;
    readonly controlType: ControlType.ENUM;
    readonly value: string;
  };
};

const VERSION = 0;

type CoverMacrosParameters = MacrosParameters<string, string | undefined>;

export class CoverMacros extends Macros<MacrosType.COVER, CoverMacrosSettings, CoverMacrosState> {
  private nextOutput: CoverMacrosNextOutput;

  constructor(parameters: CoverMacrosParameters) {
    const settings = CoverMacros.parseSettings(parameters.settings, parameters.version);
    const state = CoverMacros.parseState(parameters.state);

    super({
      /**
       * –í–µ—Ä—Å–∏—è —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞–∫—Ä–æ—Å–∞
       */
      version: VERSION,

      eventBus: parameters.eventBus,

      type: MacrosType.COVER,

      id: parameters.id,

      name: parameters.name,
      description: parameters.description,
      labels: parameters.labels,

      settings,

      state: defaultsDeep(state, {
        disable: {
          coldWater: false,
          hotWater: false,
          recirculation: false,
        },
        hotWaterTemperature: 60,
        coldWaterPumps: {},
        valves: {},
        boilerPumps: {},
        heatRequests: {},
        recirculationPumps: {},
      }),

      devices: parameters.devices,
      controls: parameters.controls,
    });

    this.nextOutput = {
      state: undefined,
      position: undefined,
    };
  }

  static parseSettings = (settings: string, version: number = VERSION): CoverMacrosSettings => {
    // if (version === VERSION) {
    //   logger('Settings in the current version ‚úÖ');
    //   logger(stringify({ from: version, to: VERSION }));

    // /**
    //  * TODO –ü—Ä–æ–≤–µ—Ä—è—Ç—å —á–µ—Ä–µ–∑ JSON Schema
    //  */

    //   return JSON.parse(settings);
    // }

    // logger('Migrate settings was started üöÄ');
    // logger(stringify({ from: version, to: VERSION }));

    // const mappers = [() => {}].slice(version, VERSION + 1);

    // logger(mappers);

    // const result = mappers.reduce((accumulator, mapper) => mapper(accumulator), JSON.parse(settings));

    // logger(stringify(result));
    // logger('Migrate settings was finished ‚úÖ');

    return JSON.parse(settings);
  };

  static parseState = (state?: string): CoverMacrosState => {
    if (!state) {
      return {
        position: 100,
        state: 'STOP',
        switch: Switch.OFF,
        illumination: -1,
        motion: -1,
        noise: -1,
        temperature: -1,
      };
    }

    /**
     * TODO –ü—Ä–æ–≤–µ—Ä—è—Ç—å —á–µ—Ä–µ–∑ JSON Schema
     */

    return JSON.parse(state);
  };

  setState = (nextPublicState: string): void => {};

  protected applyPublicState = () => {
    return false;
  };

  protected applyInput = () => {
    return false;
  };

  protected applyExternalValue() {}

  protected computeOutput = (value: string) => {
    const nextOutput: CoverMacrosNextOutput = {
      state: undefined,
      position: undefined,
    };

    this.nextOutput = nextOutput;

    logger('The next output was computed ‚è≠Ô∏è üçã');
    logger(
      stringify({
        name: this.name,
        nextState: this.state,
        nextOutput: this.nextOutput,
      }),
    );
  };

  protected applyOutput = () => {};

  protected destroy() {}

  /**
   * ! INTERNAL_IMPLEMENTATION
   */
}
