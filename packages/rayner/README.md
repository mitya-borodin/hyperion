# Rayner

## План настроек

1. Необходимо выполнить первичную настройку Wirenboard, при которой добавляются все устройства.
2. Необходимо установить [Tailscale](https://wirenboard.com/wiki/Tailscale), это решение позволит подключаться к контроллеру внутри VPN сети без поднятия своего VPN сервера, до 100 устройств и 3 пользователей, идеально для частного пользования.
3. Необходимо купить облачную виртуальную машину, и создать своего брокера с логином и паролем [MQTT](https://wirenboard.com/wiki/MQTT), это позволит получать доступ к данным контроллера и изменять их из интернета, зная логи и пароль, стоит задуматься и о работе по TLS.
4. Выполнить развертывание на той же виртуальной машине сервис `Rayner`, который будет запущен в SLAVE режиме по отношению к тому, который будет развернут в доме.
5. Выполнить развертывание на ПК в доме сервиса `Rayner`, в режиме MASTER по отношению к тому, что развернут в облаке.
6. Настроить мост между контроллером и облачным брокером.
7. Настроить мост между контроллером и компом в доме.

Все дальнейшие коммуникации по MQTT будут происходить в рамках MQTT шины контроллера.

Нужно будет завести канал, в который будут пинговать свое состояние оба компа облачный и домашний, исходя из этого знания они буду понимать в каком режиме работать.

Если домашний комп перестал присылать кинг, то облачный становится мастером.
Если какой либо комп перестал присылать пинг в течении 30 минут, то контроллер сделает алерт в каком-то виде, допустим СМС.

## Архитектура

### Аутентификация

См. [Token-Based Authentication](./docs/Token-Based-Authentication.md)

### Обнаружение устройств

При установки соединения с брокером, мы получаем данные по всем имеющимся устройствам.

Записываем в БД, информацию об устройствах как есть, и получаем информацию о устройстве и том, какие у него параметры могут быть.

Продолжаем слушать meta информацию, и обновляем информацию о устройствах.

### Обогащение данных устройств

При получении данных с устройства, мы обновляем соответствующее поле, которое было передано с устройства.

Далее мы можем добавить пользовательские данные в устройство, это позволит понимать чем оно управляет и как используется.

### Отображение текущего статуса устройства

Собранные данные, будут отображать текущее состояние устройства.
